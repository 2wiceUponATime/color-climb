[gd_scene load_steps=5 format=4 uid="uid://cxrnieyhuqo3j"]

[ext_resource type="Material" uid="uid://ccvhwyoo71d4s" path="res://resources/remap.tres" id="1_6cxcs"]
[ext_resource type="TileSet" uid="uid://b7qqmrt61pxg2" path="res://resources/tiles.tres" id="2_lgjlm"]
[ext_resource type="Script" path="res://scripts/level.gd" id="2_oux4m"]

[sub_resource type="GDScript" id="GDScript_2if31"]
script/source = "extends TileMapLayer

const PORT = 7777
const MAX_CLIENTS = 20

@onready var player: Player:
	set(value):
		player = value
		if player:
			checkpoint_sound = player.get_node(\"CheckpointSound\")
@onready var shader_material: ShaderMaterial = owner.material
@onready var checkpoint_sound: AudioStreamPlayer2D
@onready var players: Node2D = $\"../Players\"

func _process(_delta: float) -> void:
	if not player:
		player = players.get_node(str(Global.get_id()))
		return
	var tile_pos = local_to_map(to_local(player.global_position))
	if get_cell_atlas_coords(tile_pos) == Tiles.CHECKPOINT:
		var data = get_cell_tile_data(tile_pos)
		var from_white = data.get_custom_data(\"from_white\")
		var from_gray = data.get_custom_data(\"from_gray\")
		var tween = get_tree().create_tween()
		tween.parallel().tween_property(
			shader_material,
			\"shader_parameter/from_white\",
			from_white,
			0.6
		)
		tween.parallel().tween_property(
			shader_material,
			\"shader_parameter/from_gray\",
			from_gray,
			0.6
		)
		checkpoint_sound.play()
		set_cell(tile_pos, 0, Tiles.CHECKPOINT_COMPLETE)
		var spawnpoint = to_global(map_to_local(tile_pos))
		player.spawnpoint = player.get_parent().to_local(spawnpoint)
		player.save()
		Save.save()
"

[node name="Level" type="Node2D"]
material = ExtResource("1_6cxcs")
scale = Vector2(2, 2)
script = ExtResource("2_oux4m")

[node name="TileMapLayer" type="TileMapLayer" parent="."]
use_parent_material = true
tile_map_data = PackedByteArray("AAACAAoAAAABAAAAAAADAAoAAAABAAAAAAAEAAoAAAABAAAAAAAFAAoAAAABAAAAAAAGAAoAAAABAAAAAAAHAAoAAAABAAAAAAAIAAoAAAABAAAAAAAJAAoAAAABAAAAAAAKAAoAAAABAAAAAAALAAoAAAABAAAAAAAMAAoAAAABAAAAAAANAAoAAAABAAAAAAAOAAoAAAABAAAAAAAPAAoAAAABAAAAAAAQAAoAAAABAAAAAAARAAoAAAABAAAAAAASAAoAAAABAAAAAAATAAoAAAABAAAAAAAUAAkAAAAAAAAAAAAUAAgAAAAAAAIAAAATAAgAAAAAAAIAAAASAAgAAAAAAAIAAAARAAgAAAAAAAIAAAAQAAgAAAAAAAIAAAAPAAgAAAAAAAIAAAAOAAgAAAAAAAIAAAANAAgAAAAAAAIAAAAMAAgAAAAAAAIAAAALAAgAAAAAAAIAAAAKAAgAAAAAAAIAAAAJAAgAAAAAAAIAAAAIAAgAAAAAAAIAAAAHAAgAAAAAAAIAAAAEAAgAAAAAAAIAAAADAAgAAAAAAAIAAAACAAgAAAAAAAIAAAABAAgAAAAAAAIAAAACAAkAAAAAAAAAAAADAAkAAAAAAAAAAAAEAAkAAAAAAAAAAAAFAAkAAAAAAAAAAAAGAAkAAAAAAAAAAAAHAAkAAAAAAAAAAAAIAAkAAAAAAAAAAAAJAAkAAAAAAAAAAAAKAAkAAAAAAAAAAAALAAkAAAAAAAAAAAAMAAkAAAAAAAAAAAANAAkAAAAAAAAAAAAOAAkAAAAAAAAAAAAPAAkAAAAAAAAAAAAQAAkAAAAAAAAAAAARAAkAAAAAAAAAAAASAAkAAAAAAAAAAAATAAkAAAAAAAAAAAAFAAgAAAAAAAIAAAAGAAgAAAAAAAIAAAAMAAcAAAAAAAEAAQABAAkAAAAAAAAAAAARAAsAAAABAAAAAAAQAAsAAAABAAAAAAAPAAsAAAABAAAAAAAOAAsAAAABAAAAAAANAAsAAAABAAAAAAAMAAsAAAABAAAAAAALAAsAAAABAAAAAAAKAAsAAAABAAAAAAAJAAsAAAABAAAAAAAIAAsAAAABAAAAAAAHAAsAAAABAAAAAAAGAAsAAAABAAAAAAAFAAsAAAABAAAAAAAEAAsAAAABAAAAAAANAAwAAAABAAAAAAAMAAwAAAABAAAAAAALAAwAAAABAAAAAAAKAAwAAAABAAAAAAAJAAwAAAABAAAAAAAIAAwAAAABAAAAAAAYAAcAAAAAAAIAAAAZAAcAAAAAAAIAAAAaAAcAAAAAAAIAAAAXAAgAAAAAAAAAAAAYAAgAAAAAAAAAAAAZAAgAAAAAAAAAAAAaAAgAAAAAAAAAAAAYAAkAAAABAAAAAAAZAAkAAAABAAAAAAAgAAUAAAAAAAIAAAAfAAUAAAAAAAIAAAAeAAUAAAAAAAIAAAAfAAYAAAAAAAAAAAAeAAYAAAAAAAAAAAAhAAYAAAAAAAAAAAAgAAYAAAAAAAAAAAAfAAcAAAABAAAAAAAgAAcAAAABAAAAAAAhAAcAAAABAAAAAAAdAAcAAAABAAAAAAAjAAQAAAAAAAIAAAAkAAQAAAAAAAIAAAAdAAAAAAAAAAIAAAAeAAAAAAAAAAIAAAAgAAIAAAAAAAAAAAAZAP//AAAAAAIAAAAYAP//AAAAAAIAAAAXAP//AAAAAAIAAAAYAAAAAAAAAAAAAAAXAAAAAAAAAAAAAAAZAAAAAAAAAAAAAAAUAP//AAAAAAIAAAATAP//AAAAAAIAAAATAAAAAAAAAAIAAAASAAAAAAAAAAIAAAARAAAAAAAAAAIAAAAQAAAAAAAAAAIAAAAPAAAAAAAAAAIAAAAdAAEAAAAAAAAAAAAeAAEAAAAAAAAAAAAcAAEAAAAAAAAAAAAQAP//AAAAAAEAAgANAAEAAAAAAAIAAAAMAAEAAAAAAAIAAAALAAEAAAAAAAIAAAAKAAEAAAAAAAIAAAAGAAAAAAAAAAIAAAAFAAAAAAAAAAIAAAAEAAAAAAAAAAIAAAAHAAAAAAAAAAIAAAALAAIAAAAAAAAAAAAMAAIAAAAAAAAAAAANAAIAAAAAAAAAAAAQAAEAAAAAAAAAAAARAAEAAAAAAAAAAAASAAEAAAAAAAAAAAATAAEAAAAAAAAAAAAUAAAAAAAAAAAAAAAGAAEAAAAAAAAAAAAFAAEAAAAAAAAAAAAEAAEAAAAAAAAAAAADAAEAAAAAAAAAAAD+/wEAAAAAAAIAAAD9/wEAAAAAAAIAAAD+/wIAAAAAAAAAAAD//wIAAAAAAAAAAAD9/wIAAAAAAAAAAAD//wEAAQAAAAAAAQD6/wEAAAAAAAIAAAD5/wEAAAAAAAIAAAD4/wEAAAAAAAIAAAD3/wEAAAAAAAIAAAD2/wEAAAAAAAIAAAD6/wIAAAAAAAAAAAD5/wIAAAAAAAAAAAD4/wIAAAAAAAAAAAD3/wIAAAAAAAAAAAD2/wIAAAAAAAAAAAD5/wMAAAABAAAAAAD4/wMAAAABAAAAAAD3/wMAAAABAAAAAAD1/wEAAAAAAAIAAAD0/wEAAAAAAAIAAADz/wEAAAAAAAIAAADy/wEAAAAAAAIAAAD1/wIAAAAAAAAAAAD0/wIAAAAAAAAAAADz/wIAAAAAAAAAAADy/wIAAAAAAAAAAAD2/wMAAAABAAAAAAD1/wMAAAABAAAAAAD0/wMAAAABAAAAAADz/wMAAAABAAAAAAD4/wAAAQAAAAAAAQD0/wAAAQAAAAAAAQDz/wAAAQAAAAAAAQDu/wEAAAAAAAIAAADt/wEAAAAAAAIAAADu/wIAAAAAAAAAAADt/wIAAAAAAAAAAADz/wQAAAABAAAAAADy/wQAAAABAAAAAADx/wQAAAABAAAAAADw/wQAAAABAAAAAADv/wQAAAABAAAAAADu/wQAAAABAAAAAADt/wQAAAABAAAAAADt/wMAAAABAAAAAADu/wMAAAABAAAAAADy/wMAAQAAAAAAAQDx/wMAAQAAAAAAAQDw/wMAAQAAAAAAAQDv/wMAAQAAAAAAAQD0/wQAAAABAAAAAADs/wMAAAABAAAAAADs/wIAAAAAAAAAAADr/wIAAAAAAAAAAADs/wEAAAAAAAIAAADr/wEAAAAAAAIAAADr/wAAAQAAAAAAAQDq////AAAAAAIAAADo//3/AAAAAAIAAADr//z/AAAAAAIAAADs//z/AAAAAAIAAADt//z/AAAAAAIAAADu//z/AAAAAAIAAADv//z/AAAAAAIAAADs//3/AAAAAAAAAADt//3/AAAAAAAAAADu//3/AAAAAAAAAADx//r/AAAAAAIAAADy//r/AAAAAAIAAADz//r/AAAAAAIAAAD0//r/AAAAAAIAAAD1//r/AAAAAAIAAADy//v/AAABAAAAAADz//v/AAABAAAAAAD0//v/AAABAAAAAAD1//v/AAABAAAAAAD2//v/AAABAAAAAAD2//r/AQAAAAAAAQD6//r/AAAAAAIAAAD7//r/AAAAAAIAAAD8//r/AAAAAAIAAAD9//r/AAAAAAIAAAD+//r/AAAAAAIA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")
tile_set = ExtResource("2_lgjlm")
script = SubResource("GDScript_2if31")

[node name="MultiplayerSpawner" type="MultiplayerSpawner" parent="."]
_spawnable_scenes = PackedStringArray("res://scenes/player.tscn")
spawn_path = NodePath("../Players")

[node name="Players" type="Node2D" parent="."]
use_parent_material = true

[node name="Spawnpoint" type="Node2D" parent="Players"]
position = Vector2(28, 115)

[node name="FadeOut" type="CanvasModulate" parent="."]
